{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container my-5">
  
  {% if featured_post %}
  <section class="hero-section mb-5">
    <div class="hero-card-large position-relative overflow-hidden rounded-4 shadow-lg hover-zoom">
      {% if featured_post.photo %}
      <div class="hero-bg position-absolute w-100 h-100" 
           style="background-image: url('{{ featured_post.photo.url }}'); background-size: cover; background-position: center; transition: transform 0.5s;">
      </div>
      {% else %}
      <div class="hero-bg position-absolute w-100 h-100" 
           style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);">
      </div>
      {% endif %}
      <div class="hero-overlay position-absolute w-100 h-100 d-flex align-items-end"
           style="background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);">
        <div class="hero-content p-5 text-white">
          <span class="badge bg-gradient text-white px-3 py-2 rounded-pill mb-3">
            <i class="bi bi-star-fill me-1"></i> Featured • {{ featured_post.genre.name|default:"General" }}
          </span>
          <h1 class="display-4 fw-bold mb-3 hero-title">{{ featured_post.title }}</h1>
          <p class="lead mb-4 hero-excerpt opacity-90">{{ featured_post.content|safe|striptags|truncatewords:25 }}</p>
          <div class="d-flex align-items-center mb-4 text-white-50">
            <div class="me-4"><i class="bi bi-person-circle me-2"></i>{{ featured_post.author.username }}</div>
            <div><i class="bi bi-calendar-event me-2"></i>{{ featured_post.created_at|date:"F d, Y" }}</div>
          </div>
          <a href="{% url 'post_detail' featured_post.pk %}" class="btn btn-lg btn-light fw-semibold px-4 py-2 rounded-pill shadow-sm hover-lift">
            Continue Reading <i class="bi bi-arrow-right ms-2"></i>
          </a>
        </div>
      </div>
    </div>
  </section>
  {% endif %}

  <div class="row g-5">
    <!-- Main Content -->
    <div class="col-lg-8">
      <div class="section-header d-flex align-items-center justify-content-between mb-4">
        <div>
          <h2 class="section-title fw-bold mb-2 text-dark">Latest Stories</h2>
          <p class="text-muted mb-0">Discover the most recent posts from our community</p>
        </div>
        <div class="view-toggle d-none d-md-flex" role="tablist">
          <button class="btn btn-outline-secondary btn-sm me-2 active" data-view="grid"><i class="bi bi-grid-3x3-gap"></i></button>
          <button class="btn btn-outline-secondary btn-sm" data-view="list"><i class="bi bi-list"></i></button>
        </div>
      </div>

      <div class="posts-container" id="postsContainer">
        {% include 'blog/includes/post_cards.html' %}
      </div>

      <div id="paginationContainer">
        {% include 'blog/includes/pagination.html' %}
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <div class="sidebar-sticky position-sticky" style="top: 6rem;">

        <!-- Welcome Card -->
        <div class="welcome-card card border-0 shadow-sm mb-4 overflow-hidden hover-lift">
          <div class="card-body p-4 position-relative">
            <div class="welcome-bg position-absolute top-0 end-0 opacity-10">
              <i class="bi bi-chat-heart display-1 text-danger"></i>
            </div>
            <div class="position-relative">
              <h5 class="fw-bold mb-3">Welcome to Sanity Check</h5>
              <p class="text-muted mb-3 small">A community-driven blog platform powered by AI moderation.</p>
              <div class="d-flex align-items-center text-success small"><i class="bi bi-shield-check me-2"></i><span>AI-Powered Safe Space</span></div>
            </div>
          </div>
        </div>

        <!-- Popular Posts -->
        <div class="sidebar-widget card border-0 shadow-sm mb-4 hover-lift">
          <div class="card-header bg-transparent border-bottom-0 pb-0">
            <h6 class="fw-bold mb-0"><i class="bi bi-fire text-danger me-2"></i>Trending Posts</h6>
          </div>
          <div class="card-body pt-3">
            {% for post in popular_posts %}
            <div class="popular-post-item d-flex align-items-start mb-3 pb-3 border-bottom hover-bg rounded p-2">
              {% if post.photo %}
              <div class="popular-post-image me-3 flex-shrink-0">
                <img src="{{ post.photo.url }}" alt="{{ post.title }}" class="rounded" style="width: 60px; height: 60px; object-fit: cover;">
              </div>
              {% endif %}
              <div class="popular-post-content">
                <h6 class="mb-1 fw-semibold"><a href="{% url 'post_detail' post.pk %}" class="text-decoration-none text-dark hover-primary line-clamp-2">{{ post.title }}</a></h6>
                <div class="text-muted small"><i class="bi bi-calendar-event me-1"></i>{{ post.created_at|date:"M d" }} • <i class="bi bi-eye me-1"></i>{{ post.view_count|default:0 }}</div>
              </div>
            </div>
            {% empty %}
            <div class="text-center text-muted py-3"><i class="bi bi-graph-up display-4 mb-2 text-danger"></i><p class="small mb-0">No trending posts yet</p></div>
            {% endfor %}
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="sidebar-widget card border-0 shadow-sm hover-lift">
          <div class="card-header bg-transparent border-bottom-0 pb-0"><h6 class="fw-bold mb-0"><i class="bi bi-chat-dots text-danger me-2"></i>Recent Activity</h6></div>
          <div class="card-body pt-3">
            {% for comment in recent_comments %}
            <div class="recent-activity-item d-flex align-items-start mb-3 pb-3 border-bottom hover-bg rounded p-2">
              <div class="activity-icon me-3 flex-shrink-0">
                <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;">
                  <i class="bi bi-chat text-danger"></i>
                </div>
              </div>
              <div class="activity-content">
                <div class="fw-semibold small">{{ comment.author.username }}</div>
                <div class="text-muted small mb-1">commented on <a href="{% url 'post_detail' comment.post.pk %}#comment-{{ comment.pk }}" class="text-decoration-none hover-primary">{{ comment.post.title|truncatewords:4 }}</a></div>
                <p class="text-muted small mb-0 fst-italic line-clamp-2">"{{ comment.text|truncatewords:15 }}"</p>
              </div>
            </div>
            {% empty %}
            <div class="text-center text-muted py-3"><i class="bi bi-chat-square display-4 text-danger mb-2"></i><p class="small mb-0">No recent activity</p></div>
            {% endfor %}
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block javascript %}

  <script src="{% static 'js/post_list.js' %}"></script>
  

{% endblock %}

