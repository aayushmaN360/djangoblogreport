{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card border-0 shadow rounded-4 p-4">

        <!-- Profile Picture Section -->
        <div class="text-center mb-4">
          <div class="position-relative d-inline-block">
            <!-- âœ… Fixed image logic (only one <img>) -->
            <img 
              src="{% if user.profile.image %}{{ user.profile.image.url }}{% else %}{% static 'profile_pics/default.jpg' %}{% endif %}"
              alt="Profile Picture"
              class="profile-photo rounded-circle border border-3 border-white shadow">

            <!-- Edit Icon -->
            <label for="id_image" 
                   class="position-absolute bottom-0 end-0 bg-primary text-white rounded-circle p-1"
                   title="Change Picture"
                   style="cursor:pointer;">
              <i class="bi bi-pencil-fill fs-6"></i>
            </label>
            
            <!-- Hidden File Input -->
            {{ p_form.image }}
          </div>

          <h2 class="mt-3 fw-semibold">{{ user.username }}</h2>
          <p class="text-muted mb-0">Edit your personal details</p>
        </div>

        <!-- Profile Form Section -->
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <fieldset class="mb-4">
            <legend class="h5 border-bottom pb-2 mb-4 text-primary">Edit Profile Info</legend>

            <div class="row g-3">
              <!-- Username -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">{{ u_form.username.label }}</label>
                {{ u_form.username }}
                {% if u_form.username.errors %}
                  <div class="text-danger small">{{ u_form.username.errors|join:", " }}</div>
                {% endif %}
              </div>

              <!-- Email -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">{{ u_form.email.label }}</label>
                {{ u_form.email }}
                {% if u_form.email.errors %}
                  <div class="text-danger small">{{ u_form.email.errors|join:", " }}</div>
                {% endif %}
              </div>

              <!-- Bio -->
              <div class="col-12">
                <label class="form-label fw-semibold">{{ p_form.bio.label }}</label>
                {{ p_form.bio }}
                {% if p_form.bio.errors %}
                  <div class="text-danger small">{{ p_form.bio.errors|join:", " }}</div>
                {% endif %}
              </div>

              <!-- Website URL -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">{{ p_form.website_url.label }}</label>
                {{ p_form.website_url }}
                {% if p_form.website_url.errors %}
                  <div class="text-danger small">{{ p_form.website_url.errors|join:", " }}</div>
                {% endif %}
              </div>

              <!-- Twitter Handle -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">{{ p_form.twitter_handle.label }}</label>
                {{ p_form.twitter_handle }}
                {% if p_form.twitter_handle.errors %}
                  <div class="text-danger small">{{ p_form.twitter_handle.errors|join:", " }}</div>
                {% endif %}
              </div>

              <!-- GitHub -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">{{ p_form.github_handle.label }}</label>
                {{ p_form.github_handle }}
                {% if p_form.github_handle.errors %}
                  <div class="text-danger small">{{ p_form.github_handle.errors|join:", " }}</div>
                {% endif %}
              </div>
            </div>
          </fieldset>

          <div class="text-end">
            <button type="submit" class="btn btn-primary btn-lg shadow-sm">
              <i class="bi bi-check-circle-fill me-1"></i> Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Extra Styling -->
<style>
.profile-photo {
  width: 150px;
  height: 150px;
  object-fit: cover; /* keeps image centered & cropped */
}
#id_image {
  display: none; /* hide the raw input, we trigger it via label */
}
</style>
{% endblock content %}
